<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RPTX PRO | Perbaikan Kalimat Premium</title>
    <!-- Memuat Tailwind CSS untuk Styling Modern -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Memuat Font Inter dari Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <style>
        /* Menggunakan font Inter secara default */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d1117; /* Latar belakang sangat gelap */
            color: #e5e7eb; /* Teks putih keabu-abuan */
        }
        /* Styling untuk Aksen Emas (Gold) */
        .text-gold {
            color: #FFD700; /* Warna emas */
        }
        .border-gold {
            border-color: #FFD700;
        }
        .ring-gold:focus {
            --tw-ring-color: #FFD700;
        }
        /* Custom scrollbar untuk tampilan premium */
        textarea::-webkit-scrollbar {
            width: 8px;
        }
        textarea::-webkit-scrollbar-thumb {
            background-color: #4b5563; /* Abu-abu gelap */
            border-radius: 4px;
        }
        textarea::-webkit-scrollbar-thumb:hover {
            background-color: #6b7280;
        }

        /* Kelas untuk efek tombol premium */
        .btn-gold {
            background-color: #FFD700;
            color: #1f2937;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 4px 6px -1px rgba(255, 215, 0, 0.2), 0 2px 4px -2px rgba(255, 215, 0, 0.2);
        }
        .btn-gold:hover {
            background-color: #e5c100;
            transform: translateY(-1px);
            box-shadow: 0 6px 10px -1px rgba(255, 215, 0, 0.3), 0 4px 6px -3px rgba(255, 215, 0, 0.3);
        }
        .btn-gold:active {
            background-color: #ccac00;
            transform: translateY(0);
            box-shadow: none;
        }

        /* Styling untuk alert pesan salin */
        #copy-message {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 1000;
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            opacity: 0;
            transform: translateY(-20px);
        }
        .show-message {
            opacity: 1 !important;
            transform: translateY(0) !important;
        }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8 flex items-center justify-center">

    <!-- Kontainer Utama Aplikasi -->
    <div class="w-full max-w-4xl bg-[#1f2937] p-6 md:p-10 rounded-xl shadow-2xl border border-gray-700">

        <!-- Header -->
        <header class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-extrabold tracking-tight text-gold">RPTX PRO</h1>
            <p class="mt-2 text-gray-400 text-lg">Perbaiki Kalimatmu. Sempurnakan Komunikasimu.</p>
        </header>

        <!-- Area Input -->
        <section class="mb-8">
            <label for="input-text" class="block text-lg font-medium mb-2 text-gray-300">Kalimat Awal (Tidak Baku)</label>
            <textarea
                id="input-text"
                rows="4"
                placeholder="Masukkan kalimat yang ingin kamu perbaiki di sini..."
                class="w-full p-4 text-base bg-[#2a3443] text-gray-100 border border-gray-600 rounded-lg focus:outline-none ring-2 ring-transparent focus:ring-gold transition duration-200"
            ></textarea>
        </section>

        <!-- Tombol Aksi -->
        <div class="flex flex-col sm:flex-row gap-4 mb-10">
            <button
                id="fix-button"
                class="w-full py-3 px-6 rounded-lg text-lg font-semibold btn-gold flex items-center justify-center"
            >
                <svg id="fix-icon" class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                <svg id="loading-spinner" class="animate-spin -ml-1 mr-3 h-5 w-5 text-gray-800 hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                Perbaiki Kalimat
            </button>
        </div>

        <!-- Area Output -->
        <section>
            <label class="block text-lg font-medium mb-2 text-gray-300 flex justify-between items-center">
                <span>Hasil Perbaikan (Baku)</span>
                <button
                    id="copy-button"
                    class="px-3 py-1 text-sm rounded-md bg-gray-600 text-gray-200 hover:bg-gray-500 transition duration-150 disabled:opacity-50 disabled:cursor-not-allowed"
                    disabled
                >
                    <svg class="w-4 h-4 inline-block mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v14a2 2 0 002 2h10a2 2 0 002-2v-2M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v2"></path></svg>
                    Salin Hasil
                </button>
            </label>
            <textarea
                id="output-text"
                rows="4"
                placeholder="Hasil perbaikan kalimat akan muncul di sini."
                readonly
                class="w-full p-4 text-base bg-[#2a3443] text-gray-100 border border-gray-600 rounded-lg focus:outline-none resize-none cursor-default"
            ></textarea>
             <!-- Pesan Error -->
            <p id="error-message" class="text-red-400 mt-2 hidden text-sm">Terjadi kesalahan saat memproses permintaan. Silakan coba lagi.</p>
        </section>

    </div>

    <!-- Pesan Salin Berhasil (Notification Toast) -->
    <div id="copy-message" class="bg-green-600 text-white px-4 py-2 rounded-lg shadow-xl text-sm">
        Hasil perbaikan berhasil disalin!
    </div>

    <script type="module">
        // Variabel global sudah disediakan oleh lingkungan Canvas
        const apiKey = ""; // Dibiarkan kosong, akan diisi otomatis oleh Canvas
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

        // Elemen DOM
        const inputTextArea = document.getElementById('input-text');
        const outputTextArea = document.getElementById('output-text');
        const fixButton = document.getElementById('fix-button');
        const copyButton = document.getElementById('copy-button');
        const loadingSpinner = document.getElementById('loading-spinner');
        const fixIcon = document.getElementById('fix-icon');
        const errorMessage = document.getElementById('error-message');
        const copyMessage = document.getElementById('copy-message');

        /**
         * Menampilkan pesan notifikasi salin selama 2 detik.
         */
        function showCopyMessage() {
            copyMessage.classList.add('show-message');
            setTimeout(() => {
                copyMessage.classList.remove('show-message');
            }, 2000);
        }

        /**
         * Fungsi untuk menyalin teks ke clipboard.
         * Menggunakan metode document.execCommand('copy') sebagai fallback di iframe.
         */
        function copyOutputText() {
            const textToCopy = outputTextArea.value;

            // Buat elemen textarea sementara
            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = textToCopy;
            tempTextArea.style.position = 'fixed'; // Agar tidak terlihat
            tempTextArea.style.left = '-9999px';
            document.body.appendChild(tempTextArea);

            tempTextArea.select();
            
            try {
                // Gunakan execCommand sebagai metode yang paling reliable di lingkungan iframe
                const successful = document.execCommand('copy');
                if (successful) {
                    showCopyMessage();
                } else {
                    console.error('Gagal menyalin menggunakan execCommand.');
                }
            } catch (err) {
                console.error('Error saat menyalin:', err);
            } finally {
                document.body.removeChild(tempTextArea);
            }
        }


        /**
         * Mengatur status UI selama proses loading/API call.
         * @param {boolean} isLoading - True jika sedang loading, False jika selesai.
         */
        function setUIState(isLoading) {
            fixButton.disabled = isLoading;
            inputTextArea.disabled = isLoading;
            copyButton.disabled = isLoading || outputTextArea.value.trim() === '';
            errorMessage.classList.add('hidden');
            
            if (isLoading) {
                loadingSpinner.classList.remove('hidden');
                fixIcon.classList.add('hidden');
                fixButton.classList.remove('btn-gold');
                fixButton.classList.add('bg-gray-700', 'text-gray-400');
            } else {
                loadingSpinner.classList.add('hidden');
                fixIcon.classList.remove('hidden');
                fixButton.classList.add('btn-gold');
                fixButton.classList.remove('bg-gray-700', 'text-gray-400');
            }
        }

        /**
         * Melakukan panggilan ke Gemini API untuk perbaikan kalimat.
         * Mengimplementasikan exponential backoff untuk retry.
         * @param {string} text - Kalimat yang akan diperbaiki.
         */
        async function getFixedSentence(text) {
            const systemPrompt = `Kamu adalah mesin perbaikan kalimat (Grammar and Punctuation Corrector) profesional berbahasa Indonesia. Tugasmu adalah:
1. Memperbaiki struktur kalimat, tata bahasa (gramatika), dan tanda baca dari teks input pengguna.
2. Memastikan hasil output adalah baku, jelas, dan lebih efektif.
3. TIDAK PERNAH MENAMBAHKAN kata pengantar, pembuka, penutup, penjelasan, atau teks tambahan apa pun.
4. Output HANYA boleh berupa kalimat perbaikan murni.
Contoh:
Input: Aku mau makan pergi pasar kamu ikut gak
Output: Aku mau pergi ke pasar untuk makan, kamu mau ikut?
`;

            const payload = {
                contents: [{ parts: [{ text: text }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            const maxRetries = 3;
            let currentRetry = 0;

            while (currentRetry < maxRetries) {
                try {
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        // Jika status bukan 2xx, throw error untuk memicu retry
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const result = await response.json();
                    const candidate = result.candidates?.[0];

                    if (candidate && candidate.content?.parts?.[0]?.text) {
                        return candidate.content.parts[0].text.trim();
                    } else {
                        throw new Error("Respons API tidak valid atau kosong.");
                    }

                } catch (error) {
                    console.error(`Percobaan ke-${currentRetry + 1} gagal:`, error);
                    currentRetry++;

                    if (currentRetry < maxRetries) {
                        // Tunggu 2^retry * 1000 ms sebelum retry
                        const delay = Math.pow(2, currentRetry) * 1000;
                        await new Promise(resolve => setTimeout(resolve, delay));
                    } else {
                        // Semua percobaan gagal
                        throw new Error("Gagal mengambil hasil perbaikan setelah beberapa kali percobaan.");
                    }
                }
            }
        }

        /**
         * Handler utama saat tombol 'Perbaiki Kalimat' diklik.
         */
        async function handleFixSentence() {
            const inputText = inputTextArea.value.trim();

            if (!inputText) {
                outputTextArea.value = "Silakan masukkan kalimat yang ingin kamu perbaiki terlebih dahulu.";
                copyButton.disabled = true;
                return;
            }

            setUIState(true);
            outputTextArea.value = "Sedang memproses perbaikan...";
            
            try {
                const fixedText = await getFixedSentence(inputText);
                outputTextArea.value = fixedText;
                errorMessage.classList.add('hidden');
            } catch (error) {
                console.error("Kesalahan fatal dalam perbaikan:", error);
                outputTextArea.value = "Maaf, terjadi masalah saat memperbaiki kalimat. Silakan periksa koneksi atau coba lagi nanti.";
                errorMessage.classList.remove('hidden');
            } finally {
                setUIState(false);
                // Pastikan tombol salin diaktifkan hanya jika ada teks di output
                copyButton.disabled = outputTextArea.value.trim() === '' || outputTextArea.value.includes("Maaf") || outputTextArea.value.includes("Silakan");
            }
        }

        // --- Event Listeners ---
        fixButton.addEventListener('click', handleFixSentence);
        copyButton.addEventListener('click', copyOutputText);

        // Update tombol salin saat output berubah
        outputTextArea.addEventListener('input', () => {
            copyButton.disabled = outputTextArea.value.trim() === '';
        });

        // Inisialisasi awal (memastikan tombol salin nonaktif jika output kosong)
        copyButton.disabled = true;

    </script>
</body>
</html>


        const messageBox = document.getElementById('message-box');

        // Fungsi untuk menampilkan pesan (digunakan oleh fungsi copyToClipboard yang ada di kode lama)
        function showMessage(message, duration = 3000, bgColorClass = 'bg-black') {
            clearTimeout(messageBox.timeoutId);
            
            messageBox.textContent = message;
            // Pastikan opacity 100 saat tampil
            messageBox.className = `fixed top-0 left-1/2 transform -translate-x-1/2 mt-4 p-3 ${bgColorClass} text-white text-sm rounded-lg shadow-xl transition-opacity duration-300 opacity-100 z-50 pointer-events-none`;
            
            messageBox.timeoutId = setTimeout(() => {
                // Atur kembali ke opacity 0 setelah durasi
                messageBox.className = messageBox.className.replace('opacity-100', 'opacity-0');
            }, duration);
        }
        
        // Inisialisasi link WhatsApp
        document.addEventListener('DOMContentLoaded', () => {
            const whatsappLink = document.getElementById('whatsapp-link');
            // Pesan otomatis: "Saya mau, mohon infonya lebih lanjut."
            const customMessage = encodeURIComponent("Saya mau, mohon infonya lebih lanjut.");
            
            // Periksa apakah nomor sudah diatur
            if (WHATSAPP_NUMBER && WHATSAPP_NUMBER !== "6287788836766") {
                // Hapus placeholder copy functions yang tidak digunakan, tapi biarkan showMessage
                console.log("Nomor WhatsApp telah diatur.");
            } else {
                 console.warn("PERINGATAN: Nomor WhatsApp masih menggunakan nomor contoh. Harap ganti variabel WHATSAPP_NUMBER.");
            }

            // Setel href link WhatsApp
            whatsappLink.href = `https://wa.me/${WHATSAPP_NUMBER}?text=${customMessage}`;
        });
    </script>
</body>
</html>
